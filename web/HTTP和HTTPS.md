# 什么是HTTP

>&nbsp;&nbsp;&nbsp;&nbsp;超文本传输协议，是一个基于请求与响应，无状态的，应用层的协议，常基于TCP/IP协议传输数据，互联网上应用最为广泛的一种网络协议,所有的WWW文件都必须遵守这个标准。设计HTTP的初衷是为了提供一种发布和接收HTML页面的方法。

| 版本|生产时间 |内容 |发展状态 |
|-|-|-|-|
|HTTP/0.9 |1991年	 |不涉及数据包传输，规定客户端和服务器之间通信格式，只能GET请求 |没有作为正式的标准 |
| HTTP/1.0| 1996年| 传输内容格式不限制，增加PUT、PATCH、HEAD、 OPTIONS、DELETE命令|正式作为标准 |
|HTTP/1.1 |1997年 | 持久连接(长连接)、节约带宽、HOST域、管道机制、分块传输编码|2015年前使用最广泛 |
|HTTP/2 | 2015年|多路复用、服务器推送、头信息压缩、二进制协议等 | 逐渐覆盖市场|

![](https://github.com/wuxiaobo000111/pictures/blob/master/2019-03-17/10.png?raw=true "")

>&nbsp;&nbsp;&nbsp;&nbsp;这个Akamai公司建立的一个官方的演示，使用HTTP/1.1和HTTP/2同时请求379张图片，观察请求的时间，明显看出HTTP/2性能占优势。 

![](https://github.com/wuxiaobo000111/pictures/blob/master/2019-03-17/11.jpg?raw=true "")


>&nbsp;&nbsp;&nbsp;&nbsp;多路复用：通过单一的HTTP/2连接请求发起多重的请求-响应消息，多个请求stream共享一个TCP连接，实现多留并行而不是依赖建立多个TCP连接。

# HTTP的特点
```text
1.无状态：协议对客户端没有状态存储，对事物处理没有“记忆”能力，比如访问一个网站需要反复进行登录操作
2.无连接：HTTP/1.1之前，由于无状态特点，每次请求需要通过TCP三次握手四次挥手，和服务器重新建立连接。比如某个客户机在短时间多
次请求同一个资源，服务器并不能区别是否已经响应过用户的请求，所以每次需要重新响应请求，需要耗费不必要的时间和流量。
3.基于请求和响应：基本的特性，由客户端发起请求，服务端响应
4.简单快速、灵活
5.通信使用明文、请求和响应不会对通信方进行确认、无法保护数据的完整性
```

# HTTP通信传输
![](https://github.com/wuxiaobo000111/pictures/blob/master/2019-03-18/1.jpg?raw=true "")

>&nbsp;&nbsp;&nbsp;&nbsp;客户端输入URL回车，DNS解析域名得到服务器的IP地址，服务器在80端口监听客户端请求，端口通过TCP/IP协议（可以通过Socket实现）建立连接。HTTP属于TCP/IP模型中的运用层协议，所以通信的过程其实是对应数据的入栈和出栈。 

![](https://github.com/wuxiaobo000111/pictures/blob/master/2019-03-18/2.jpg?raw=true "")

![](https://github.com/wuxiaobo000111/pictures/blob/master/2019-03-18/3.jpg?raw=true "")

>&nbsp;&nbsp;&nbsp;&nbsp;为什么需要三次握手呢？为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误。比如：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段，但是server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求，于是就向client发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了，由于client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据，但server却以为新的运输连接已经建立，并一直等待client发来数据。所以没有采用“三次握手”，这种情况下server的很多资源就白白浪费掉了。

![](https://github.com/wuxiaobo000111/pictures/blob/master/2019-03-18/4.jpg?raw=true "")


>&nbsp;&nbsp;&nbsp;&nbsp;为什么需要四次挥手呢？TCP是全双工模式，当client发出FIN报文段时，只是表示client已经没有数据要发送了，client告诉server，它的数据已经全部发送完毕了；但是，这个时候client还是可以接受来server的数据；当server返回ACK报文段时，表示它已经知道client没有数据发送了，但是server还是可以发送数据到client的；当server也发送了FIN报文段时，这个时候就表示server也没有数据要发送了，就会告诉client，我也没有数据要发送了，如果收到client确认报文段，之后彼此就会愉快的中断这次TCP连接。


# 什么是HTTPS

>&nbsp;&nbsp;&nbsp;&nbsp;HTTPS是身披SSL外壳的HTTP。HTTPS是一种通过计算机网络进行安全通信的传输协议，经由HTTP进行通信，利用SSL/TLS建立全信道，加密数据包。HTTPS使用的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私与完整性。
PS:TLS是传输层加密协议，前身是SSL协议，由网景公司1995年发布，有时候两者不区分。

# HTTPS的特点
```text
1.内容加密：采用混合加密技术，中间者无法直接查看明文内容
2.验证身份：通过证书认证客户端访问的是自己的服务器
3.保护数据完整性：防止传输的内容被中间人冒充或者篡改
```

# HTTP实现原理


![](https://github.com/wuxiaobo000111/pictures/blob/master/2019-03-18/5.jpg?raw=true "")

```text
client向server发送请求https://baidu.com，然后连接到server的443端口。

服务端必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面，这套证书其实就是一对公钥和私钥。

传送证书 
这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间、服务端的公钥，第三方证书认证机构(CA)的签名，服务端的域名信息等内容。

客户端解析证书 
这部分工作是由客户端的TLS来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随即值（秘钥）。然后用证书对该随机值进行加密。

传送加密信息 
这部分传送的是用证书加密后的秘钥，目的就是让服务端得到这个秘钥，以后客户端和服务端的通信就可以通过这个随机值来进行加密解密了。

服务段加密信息 
服务端用私钥解密秘密秘钥，得到了客户端传过来的私钥，然后把内容通过该值进行对称加密。

传输加密后的信息 
这部分信息是服务端用私钥加密后的信息，可以在客户端被还原。

客户端解密信息 
客户端用之前生成的私钥解密服务端传过来的信息，于是获取了解密后的内容。

```

>&nbsp;&nbsp;&nbsp;&nbsp;其实总结一下就是首先通过非对称加密的手段,把客户端生成的一个对称加密的秘钥发送到服务端,服务端通过私钥解密得到这个对称加密的秘钥,然后客户端和服务端是通过对称加密进行通信的。
