
# 概述

>&nbsp;&nbsp;&nbsp;&nbsp;当redis使用读写分离的时候可能会带来如下问题:复制数据延迟,读到过期数据和从节点故障。

# 复制数据延迟

# 读到过期数据

>当主节点存储大量设置超时的数据的时候,如缓存数据,Redis内部需要维护过期数据删除策略。删除策略主要有两种方式:惰性删除和定时删除。

```text
1. 惰性删除:主节点每次处理读取命令的时候,都会检查键是否超时,如果超时则执行del命令删除键对象,之后del命令
也会异步发送给从节点。从节点从来不会主动删除超时数据。
2. 定时删除:Redis主节点在内部定时任务会循环采样一定数据的键,当发现采样的键时候执行del命令,之后再次通
过给从节点。

上述两种方式如下图所示:

```


![在这里插入图片描述](https://github.com/wuxiaobo000111/pictures/blob/master/2019-04-09/2.jpg?raw=true)



![在这里插入图片描述](https://github.com/wuxiaobo000111/pictures/blob/master/2019-04-09/3.jpg?raw=true)

>如果此时数据大量超时,主节点的采样速度跟不上过期速度并且主节点并没有读取过期键的操作,那么从节点无法接受del命令。这个时候还是会在从节点上读到超时的数据。可以通过升级Redis的版本来解决这个问题。

# 从节点故障问题

>需在在客户端维护可用从节点列表,当从节点故障的时候可以立即切换到其他从节点或者是主节点上。